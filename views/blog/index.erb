<%= erb "blog/_header".to_sym %>

<div class="blog posts">
  <% posts.each do |path, data| %>
    <% content = [data[:content].match(/<\/h3>(.+?)<h4>/m), $1].last %>
    <section id="<%= path %>" class="post">
      <div class="page-header"><h3><%= data[:title] %></h3></div>

      <% if content.include?("<!-- read more -->") %>
        <%= content.sub("<!-- read more -->", "<br><br><a href=\"/blog/#{path.sub("#{path.to_i}-", "")}\"><i class=\"icon-chevron-right\"></i> Read more</a>") %>
      <% else %>
        <%= content %>

        <p><a href="/blog/<%= path.sub("#{path.to_i}-", "") %>"><i class="icon-chevron-right"></i> Read more</a></p>
      <% end %>
    </section>
  <% end %>
</div>
